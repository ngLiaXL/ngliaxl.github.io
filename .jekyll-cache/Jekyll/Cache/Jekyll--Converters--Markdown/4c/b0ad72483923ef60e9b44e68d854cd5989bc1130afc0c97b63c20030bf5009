I"Í<h3 id="1é…ç½®ä¾èµ–åŒ…">1ã€é…ç½®ä¾èµ–åŒ…</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    // Room
    def room_version = "1.1.0"
    api "android.arch.persistence.room:runtime:$room_version"
    api("android.arch.persistence.room:compiler:$room_version") {
        exclude group: 'com.google.code.gson'
    }
</code></pre></div></div>

<h3 id="2ç»§æ‰¿roomdatabase">2ã€ç»§æ‰¿RoomDatabase</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@android.arch.persistence.room.Database(
        entities = {
                PosUserT.class,

        },
        version = 1)
@TypeConverters(DateConverter.class)
public abstract class Database extends RoomDatabase {

    private static volatile Database INSTANCE;

    public abstract UserDao userDao();


//    static final Migration MIGRATION_1_2 = new Migration(1, 2) {
//        @Override
//        public void migrate(SupportSQLiteDatabase mDatabase) {
//            mDatabase.execSQL("ALTER TABLE DIS_SHOP_REMOVE_GOODS_T "
//                    + " ADD COLUMN OPER_GOODS_TYPE VARCHAR");
//        }
//    };

    public static Database getInstance(Context context) {
        if (INSTANCE == null) {
            synchronized (Database.class) {
                if (INSTANCE == null) {
                    INSTANCE = Room.databaseBuilder(context.getApplicationContext(), Database.class, "retail.db")
                            .allowMainThreadQueries()
                            .build();
//                    INSTANCE = Room.databaseBuilder(context.getApplicationContext(), Database.class, "retail.db")
//                            .addMigrations(MIGRATION_1_2).build();
                }
            }
        }
        return INSTANCE;
    }
}

</code></pre></div></div>
<p><code class="highlighter-rouge">allowMainThreadQueries()</code>æ–¹æ³•å¯ä»¥è®¾ç½®åœ¨UIçº¿ç¨‹æ“ä½œæ•°æ®åº“
<code class="highlighter-rouge">addMigrations()</code>æ•°æ®åº“ç‰ˆæœ¬å‡çº§</p>

<h3 id="3å»ºè¡¨">3ã€å»ºè¡¨</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Entity(tableName = "pos_user_t")
public class PosUserT {

    @NonNull
    @PrimaryKey()
    @ColumnInfo(name = "user_id")
    @SerializedName(value = "userid" , alternate = {"user_id",})
    public String userId;

	...
}
</code></pre></div></div>

<h3 id="4è‡ªå®šä¹‰daoæ¥å£">4ã€è‡ªå®šä¹‰DAOæ¥å£</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Dao
public interface UserDao extends BaseDao {

    @Query("SELECT user_password FROM pos_user_t WHERE user_code = :userCode")
    String queryPasswordByUserCode(String userCode);

    @Query("DELETE FROM pos_user_t WHERE user_code = :userCode")
    int deleteByUserCode(String userCode);

    @Insert(onConflict = OnConflictStrategy.REPLACE)
    long insert(PosUserT user);

    @Insert(onConflict = OnConflictStrategy.REPLACE)
    long[] insert(List&lt;PosUserT&gt; users);

    @Query("DELETE FROM pos_user_t")
    int deleteAll();

	...
	
}
</code></pre></div></div>

<h3 id="5ä½¿ç”¨">5ã€ä½¿ç”¨</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Database.getInstance(context).getUserDao().insert();
</code></pre></div></div>

:ET